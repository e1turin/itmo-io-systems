# Лабораторная работа 1

**Название:** "Разработка драйверов символьных устройств"

**Цель работы:** 

> Получить знания и навыки разработки драйверов символьных устройств для
> операционной системы Linux.

## Описание функциональности драйвера

> При записи в файл символьного устройства текста, содержащего цифры, должен
> запоминаться результат умножения всех чисел, разделенных другими символами
> (буквы, пробелы и т.п.). Последовательность полученных результатов с момента
> загрузки модуля ядра должна выводиться при чтении файла

## Инструкция по сборке

Для сборки модуля ядра из исходного кода нужно в директории `lab-1/driver/`
выполнить цель по умолчанию для `make`, при этом требуется права
суперпользователя:

```shell 
sudo make 
```

После успешной компиляции в той же директории должен появиться файл
`ch_drv.ko`.


## Инструкция пользователя

Для загрузки модуля нужно выполнить соответствующую команду с правами
администратора:

```shell
sudo insmod ch_drv.ko
```

Проверить загрузку модуля можно с помощью команд:

```sudo 
lsmod | grep ch_drv
```

Для выгрузки модуля нужно выполнить соответствующую команду с правами
администратора:

```shell
sudo rmmod ch_drv
```

Модуль создает файл символьного устройства `var8` в каталоге `/dev/`, в который
можно записывать и читать текстовые данные.

### Переполнение

Размер буфера для хранения предыдущих результатов ограничен, поэтому при 
переполнении в кольцевой буфер ядра (содержимое которого можно прочитать с
помощью привилегированной команды `dmesg`) выводится сообщение об очистке
буфера.

Наподобие такого:

```text
[  244.192236] Mydrv: History is full. Clearing history.
```

## Примеры использования

Для работы с устройством требуются права суперпользователя, 
которые можно получить, к примеру командой

```shell
sudo su
```

Пример записи в файл устройства:

```shell
echo "kek2lol3idk4etc" > /dev/var8
echo "3aka4omg5" > /dev/var8
```

Пример чтения из файла устройства:

```shell
cat /dev/var8
```
и пример вывода для предыдущего ввода:

```shell
24, 60;
```

Аналогично можно производить чтение/запись через программный интерфейс
`read(2)` и `write(2)`.


